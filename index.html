<html>
  <head>
    <title>Socket.io Chat</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      h2 {
        color: #007BFF;
        text-align: center;
        margin-top: 50px;
      }
      ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        background-color: #ddd;
      }
      li {
        padding: 10px;
        border-bottom: 1px solid #bbb;
        background-color: #f9f9f9;
      }
      input[type="text"] {
        width: 70%;
        padding: 12px 20px;
        margin: 8px 0;
        box-sizing: border-box;
        border: 2px solid #007BFF;
        border-radius: 4px;
      }
      button {
        background-color: #007BFF;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        cursor: pointer;
        width: 20%;
        border-radius: 4px;
      }
      button:hover {
        background-color: #007BFF;
      }
    </style>
  </head>
  <body>
    <h2>Chat Room of <label id="usernameChat"></label></h2>
    <ul id="messages"></ul>
    <input id="messageInput" type="text" autocomplete="off" />
    <button onclick="sendMessage()">Send General Message</button>
    <br />
    <br />
    <h2>Private Chat</h2>
    <input id="recipientInput" placeholder="Recipient's username" />
    <input id="privateMessageInput" autocomplete="off" type="text" />
    <button onclick="sendPrivateMessage()">Send Private Message</button>
    <ul id="privateMessages"></ul>
    
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
      const socket = io("http://localhost:3010");

      const username = prompt("Enter your username:");
      document.querySelector("#usernameChat").innerHTML = username;
      if (username) {
        socket.emit("join", username);
      }

      socket.on("message", (data) => {
        displayMessage(data);
      });

      socket.on("privateMessage", (data) => {
        displayPrivateMessage(data);
      });

      function sendMessage() {
        const messageInput = document.getElementById("messageInput");
        const message = messageInput.value.trim();
        if (message !== "") {
          socket.emit("message", message);
          messageInput.value = "";
          //necesito una nueva instancia en la base de datos mongoDb con los atributos del mensaje
          // Create a new instance in the MongoDB database with the attributes of the message
          // Assuming you have a MongoDB connection and a collection called "messages"
          const messageData = {
            user: username,
            message: message
          };

          // Assuming you have a MongoDB connection and a collection called "messages"
          // Insert the message data into the MongoDB collection
          db.collection("messages").insertOne(messageData, (error, result) => {
            if (error) {
              console.error("Error inserting message into MongoDB:", error);
            } else {
              console.log("Message inserted into MongoDB:", result);
            }
          });

        }
      }

      function sendPrivateMessage() {
        const recipientInput = document.getElementById("recipientInput");
        const privateMessageInput = document.getElementById(
          "privateMessageInput"
        );
        const recipient = recipientInput.value.trim();
        const message = privateMessageInput.value.trim();
        if (recipient && message) {
          socket.emit("privateMessage", { recipient, message });
          displayPrivateMessage({ user: "You", recipient, message });
          privateMessageInput.value = "";
        }
      }

      function displayMessage(data) {
        const messages = document.getElementById("messages");
        const li = document.createElement("li");
        li.innerHTML = `<strong>${data.user}:</strong> ${data.message}`;
        messages.appendChild(li);
      }

      function displayPrivateMessage(data) {
        const privateMessages = document.getElementById("privateMessages");
        const li = document.createElement("li");
        li.innerHTML = `<strong>${data.user} to ${data.recipient}:</strong> ${data.message}`;
        privateMessages.appendChild(li);
      }
    </script>
  </body>
</html>
